@startuml
skinparam linetype ortho
hide methods

package "Katalog" as PK {
  class MusicItem {
    id: int
    title: string
    item_type: string  <<TRACK|ALBUM|OTHER>>
    release_year: int ?
    duration_seconds: int ?
  }

  class Artist {
    id: int
    name: string
  }

  class Genre {
    id: int
    name: string <<UNIQUE>>
  }

  class MusicItemArtist {
    music_item_id: int <<PK,FK>>
    artist_id: int     <<PK,FK>>
    role: string <<PK, PRIMARY|FEATURED|PRODUCER>>
  }

  class MusicItemGenre {
    music_item_id: int <<PK,FK>>
    genre_id: int      <<PK,FK>>
  }

  class AlbumTrack {
    album_id: int  <<PK,FK>>
    track_id: int  <<PK,FK>>
    track_number: int
  }

  class TrackFile {
    id: int <<PK>>
    track_id: int <<FK, UNIQUE>>
    filename: string
    content_type: string ?
    file_data: bytea
    compressed: bool
    original_size: int ?
    created_at: timestamptz
  }
}

package "Benutzer & Interaktion" as PB {
  class User {
    id: int
    email: string <<UNIQUE>>
    display_name: string
    role: string <<ADMIN|USER>>
  }

  class Review {
    id: int
    user_id: int  <<FK>>
    music_item_id: int <<FK>>
    rating: int ?  <<1..5>>
    text: text ?
    --
    <<UNIQUE(user_id, music_item_id)>>
  }

  class UserCollection {
    user_id: int  <<PK,FK>>
    music_item_id: int <<PK,FK>>
    preference: string <<LIKE|DISLIKE|NONE>>
    is_favourite: bool
    note: text ?
  }
}

MusicItem "1" -- "0..*" MusicItemArtist : has >
Artist    "1" -- "0..*" MusicItemArtist : has >
MusicItem "1" -- "0..*" MusicItemGenre  : has >
Genre     "1" -- "0..*" MusicItemGenre  : has >

User      "1" -- "0..*" Review     : writes >
MusicItem "1" -- "0..*" Review     : has >

User      "1" -- "0..*" UserCollection : owns >
MusicItem "1" -- "0..*" UserCollection : listed in >

MusicItem "1" -- "0..*" AlbumTrack : album_id
AlbumTrack "0..*" -- "1" MusicItem : track_id

MusicItem "1" -- "0..1" TrackFile : file >

PK -[hidden]down-> PB

@enduml